<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monitor ECG</title>
    <style>
        :root {
            --bg-color: #000000;
            --panel-bg: #0a0a0a;
            --ecg-line: #d4ff00;
            --text-color: #e0e0e0;
            --accent: #0088cc;
            --danger: #ff3333;
            --warning: #ffaa00;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        header {
            background: var(--panel-bg);
            border-bottom: 1px solid #222;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 50px;
        }

        h1 { font-size: 1rem; color: #fff; letter-spacing: 1px; text-transform: uppercase; }
        .status { font-family: monospace; color: var(--ecg-line); font-size: 0.9rem; }

        .main-container {
            display: flex;
            flex: 1;
            height: calc(100vh - 50px);
        }

        .monitor-area {
            flex: 2;
            position: relative;
            background-color: #000;
            border-right: 2px solid #1a1a1a;
            overflow: hidden;
        }

        canvas {
            display: block;
            width: 100%;
            height: 100%;
            background-color: #000;
        }

        .controls-area {
            flex: 1;
            background-color: var(--panel-bg);
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            min-width: 300px;
            border-left: 1px solid #222;
            overflow-y: auto;
        }

        .info-card {
            background: #151515;
            border-left: 5px solid var(--accent);
            padding: 15px;
            border-radius: 2px;
        }
        .info-card h2 { color: #fff; font-size: 1.1rem; margin-bottom: 5px; }
        .info-card p { color: #aaa; font-size: 0.9rem; line-height: 1.4; }

        .playback-controls {
            display: flex;
            gap: 10px;
            background: #1a1a1a;
            padding: 10px;
            border-radius: 4px;
            align-items: center;
            justify-content: space-between;
        }

        button.btn-control {
            background: #2a2a2a;
            color: #fff;
            border: 1px solid #444;
            padding: 8px 15px;
            cursor: pointer;
            font-weight: bold;
            border-radius: 3px;
            flex: 1;
            text-transform: uppercase;
            font-size: 0.8rem;
        }
        button.btn-control:hover { background: #333; }
        button.btn-control.active { background: var(--accent); border-color: var(--accent); }
        button.btn-control.danger-active { background: var(--danger); border-color: var(--danger); }

        .rhythm-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .btn-rhythm {
            background: #1a1a1a;
            border: 1px solid #333;
            color: #ccc;
            padding: 10px;
            cursor: pointer;
            text-align: left;
            font-size: 0.75rem;
            border-radius: 2px;
            transition: all 0.2s;
        }
        .btn-rhythm:hover { background: #252525; color: #fff; }
        .btn-rhythm.active {
            background: #252525;
            border-left: 3px solid var(--ecg-line);
            color: var(--ecg-line);
            font-weight: bold;
        }

        .btn-rhythm.warn { border-left: 3px solid var(--warning); }
        .btn-rhythm.danger { border-left: 3px solid var(--danger); }
        .btn-rhythm.warn.active { background: #2a2510; color: var(--warning); }
        .btn-rhythm.danger.active { background: #2a1010; color: var(--danger); }

        @media (max-width: 800px) {
            .main-container { flex-direction: column; }
            .monitor-area { height: 50vh; border-right: none; border-bottom: 2px solid #1a1a1a; }
        }
    </style>
</head>
<body>

<header>
    <h1>Monitor Cardíaco</h1>
    <div class="status">LEAD II | 25mm/s</div>
</header>

<div class="main-container">
    <div class="monitor-area">
        <canvas id="ecgCanvas"></canvas>
    </div>

    <div class="controls-area">
        <div class="playback-controls">
            <button id="btnPause" class="btn-control" onclick="togglePause()">⏸ Pausar</button>
            <div style="display:flex; gap:5px;">
                <button class="btn-control active" onclick="setSpeed(1)" id="btn25">25mm/s</button>
                <button class="btn-control" onclick="setSpeed(2)" id="btn50">50mm/s</button>
            </div>
        </div>

        <div class="info-card" id="infoCard">
            <h2 id="rhythmTitle">Ritmo Sinusal Normal</h2>
            <p id="rhythmDesc">Ritmo cardíaco normal. O impulso elétrico inicia no nó sinusal, gerando uma onda P, seguida de um complexo QRS estreito e uma onda T.</p>
        </div>

        <div style="font-size: 0.75rem; color: #666; text-transform: uppercase; letter-spacing: 1px; margin-top: 10px;">Selecione o Ritmo</div>

        <div class="rhythm-grid">
            <button class="btn-rhythm active" onclick="setRhythm('normal')">Sinusal Normal</button>
            <button class="btn-rhythm" onclick="setRhythm('bradycardia')">Bradicardia</button>
            <button class="btn-rhythm" onclick="setRhythm('tachycardia')">Taquicardia</button>
            <button class="btn-rhythm" onclick="setRhythm('arrhythmia')">Arritmia Sinusal</button>

            <button class="btn-rhythm warn" onclick="setRhythm('av1')">Bloqueio AV 1º Grau</button>
            <button class="btn-rhythm warn" onclick="setRhythm('brd')">Bloqueio Ramo Dir.</button>
            <button class="btn-rhythm warn" onclick="setRhythm('flutter')">Flutter Atrial</button>
            <button class="btn-rhythm warn" onclick="setRhythm('pvc')">Extrassístole (PVC)</button>

            <button class="btn-rhythm danger" onclick="setRhythm('afib')">Fibrilação Atrial</button>
            <button class="btn-rhythm danger" onclick="setRhythm('vfib')">Fibrilação Vent.</button>
            <button class="btn-rhythm danger" onclick="setRhythm('asystole')">Assistolia</button>
        </div>
    </div>
</div>

<script>
    const canvas = document.getElementById('ecgCanvas');
    const ctx = canvas.getContext('2d');

    let width, height;
    let x = 0;
    let y = 0;
    let currentRhythm = 'normal';
    let frame = 0;
    let baseSpeed = 2;
    let currentSpeed = baseSpeed;
    let isPaused = false;

    const rhythms = {
        normal: { title: "Ritmo Sinusal Normal", desc: "Frequência 60-100 bpm. Onda P presente, intervalo PR constante, QRS estreito. Ritmo regular.", bpm: 75, type: 'regular' },
        bradycardia: { title: "Bradicardia Sinusal", desc: "Frequência < 60 bpm. Morfologia das ondas normal, mas o intervalo entre batimentos é maior.", bpm: 40, type: 'regular' },
        tachycardia: { title: "Taquicardia Sinusal", desc: "Frequência > 100 bpm. Morfologia normal, mas os batimentos estão muito próximos.", bpm: 150, type: 'regular' },
        arrhythmia: { title: "Arritmia Sinusal", desc: "Variação da frequência associada à respiração. Ritmo irregular, mas ondas normais.", bpm: 70, type: 'irregular_rate' },
        av1: { title: "Bloqueio AV 1º Grau", desc: "Condução lenta. Intervalo PR longo (> 0.20s), mas todo batimento é conduzido.", bpm: 70, type: 'long_pr' },
        brd: { title: "Bloqueio de Ramo Direito", desc: "Atraso na condução do VD. QRS alargado (> 0.12s) com padrão rSR' (dente de coelho).", bpm: 70, type: 'wide_qrs' },
        flutter: { title: "Flutter Atrial", desc: "Atividade atrial rápida. Ondas em 'dente de serra' na linha de base.", bpm: 150, type: 'sawtooth' },
        pvc: { title: "Extrassístole Ventricular", desc: "Batimento prematuro do ventrículo. QRS largo e bizarro, seguido de pausa.", bpm: 70, type: 'pvc' },
        afib: { title: "Fibrilação Atrial", desc: "Atividade atrial caótica. Sem ondas P. Linha de base tremida e ritmo irregular.", bpm: 0, type: 'chaotic' },
        vfib: { title: "Fibrilação Ventricular", desc: "Emergência. O ventrículo treme sem bombear. Ondas caóticas e irregulares.", bpm: 0, type: 'critical' },
        asystole: { title: "Assistolia", desc: "Ausência de atividade elétrica. Linha reta.", bpm: 0, type: 'flat' }
    };

    function init() {
        resize();
        window.addEventListener('resize', resize);
        animate();
    }

    function resize() {
        width = canvas.parentElement.offsetWidth;
        height = canvas.parentElement.offsetHeight;
        canvas.width = width;
        canvas.height = height;
        ctx.fillStyle = "#000000";
        ctx.fillRect(0, 0, width, height);
        x = 0;
        y = height / 2;
    }

    function togglePause() {
        isPaused = !isPaused;
        const btn = document.getElementById('btnPause');
        if (isPaused) {
            btn.innerHTML = "▶ Continuar";
            btn.classList.add('danger-active');
        } else {
            btn.innerHTML = "⏸ Pausar";
            btn.classList.remove('danger-active');
        }
    }

    function setSpeed(factor) {
        currentSpeed = baseSpeed * factor;
        document.getElementById('btn25').classList.toggle('active', factor === 1);
        document.getElementById('btn50').classList.toggle('active', factor === 2);
    }
    setSpeed(1);

    function getSignalValue(t) {
        const centerY = height / 2;
        const amp = height * 0.25;

        if (currentRhythm === 'asystole') return centerY + (Math.random() * 1.5 - 0.75);
        if (currentRhythm === 'vfib') return centerY + (Math.sin(t * 0.1) * 40) + (Math.sin(t * 0.35) * 20) + (Math.random() * 50 - 25);

        if (currentRhythm === 'afib') {
            let noise = (Math.random() * 6 - 3);
            if (Math.random() < 0.012) return centerY + drawQRS(0, amp, 'normal');
            return centerY + noise;
        }

        if (currentRhythm === 'flutter') {
            let flutter = Math.sin(t * 0.6) * 8;
            if (t % 50 < 8) return centerY + flutter + drawQRS(0, amp, 'normal');
            return centerY + flutter;
        }

        if (currentRhythm === 'pvc') {
            const bpm = rhythms[currentRhythm].bpm;
            const cycle = (60 / bpm) * 60;
            const posInCycle = t % cycle;
            const beatNum = Math.floor(t / cycle);
            const isPVC = (beatNum % 4 === 3);
            if (isPVC && posInCycle > cycle * 0.3 && posInCycle < cycle * 0.5) {
                return centerY + drawQRS(posInCycle, amp, 'pvc');
            }
            return getRegularBeat(t, centerY, amp);
        }

        return getRegularBeat(t, centerY, amp);
    }

    function getRegularBeat(t, centerY, amp) {
        const bpm = rhythms[currentRhythm].bpm;
        let cycleLen = (60 / bpm) * 60;
        if (currentRhythm === 'arrhythmia') cycleLen += Math.sin(t * 0.02) * 15;
        const phase = (t % cycleLen) / cycleLen;
        return centerY + drawWaveform(phase, amp);
    }

    function drawWaveform(phase, amp) {
        let val = 0;
        const type = rhythms[currentRhythm].type;

        let pTime = 0.15;
        if (phase > pTime && phase < pTime + 0.08) {
            val -= Math.sin((phase - pTime) * Math.PI * 12) * 0.25;
        }

        let qrsStart = 0.25;
        let qrsWidth = 0.06;
        if (type === 'long_pr') qrsStart = 0.45;
        if (type === 'wide_qrs') qrsWidth = 0.14;

        if (phase > qrsStart && phase < qrsStart + qrsWidth) {
            let localPhase = (phase - qrsStart) / qrsWidth;
            if (type === 'wide_qrs') {
                if (localPhase < 0.2) val -= 0.15;
                else if (localPhase < 0.5) val += 0.4;
                else val -= 0.7;
            } else if (type === 'pvc') {
                val -= Math.sin(localPhase * Math.PI) * 1.3;
            } else {
                if (localPhase < 0.15) val += 0.1;
                else if (localPhase < 0.45) val -= 1.0;
                else val += 0.3;
            }
        }

        let tStart = 0.55;
        if (type === 'long_pr') tStart = 0.75;
        if (phase > tStart && phase < tStart + 0.15) {
            val -= Math.sin((phase - tStart) * Math.PI * 6) * 0.35;
        }

        return val * amp;
    }

    function drawQRS(t, amp, type) {
        if (type === 'pvc') return -Math.sin((t%20)/20 * Math.PI) * 1.3 * amp;
        return -Math.sin((t%10)/10 * Math.PI) * amp;
    }

    function animate() {
        if (!isPaused) {
            ctx.fillStyle = "#000000";
            ctx.fillRect(x, 0, currentSpeed + 2, height);

            ctx.beginPath();
            ctx.strokeStyle = "#d4ff00";
            ctx.lineWidth = 2;
            ctx.lineCap = "round";
            ctx.lineJoin = "round";

            const newY = getSignalValue(frame);

            ctx.moveTo(x, y);
            let newX = x + currentSpeed;

            if (newX > width) {
                newX = 0;
                ctx.fillStyle = "#000000";
                ctx.fillRect(0, 0, width, height);
                y = newY;
                ctx.moveTo(newX, y);
            }

            ctx.lineTo(newX, newY);
            ctx.stroke();

            x = newX;
            y = newY;
            frame++;
        }

        requestAnimationFrame(animate);
    }

    function setRhythm(key) {
        currentRhythm = key;
        const data = rhythms[key];

        document.getElementById('rhythmTitle').innerText = data.title;
        document.getElementById('rhythmDesc').innerText = data.desc;

        document.querySelectorAll('.btn-rhythm').forEach(btn => btn.classList.remove('active'));
        const buttons = document.querySelectorAll('.btn-rhythm');
        buttons.forEach(btn => {
            if(btn.getAttribute('onclick').includes(`'${key}'`)) btn.classList.add('active');
        });

        const card = document.getElementById('infoCard');
        if (['vfib', 'asystole'].includes(key)) card.style.borderLeftColor = 'var(--danger)';
        else if (['av1', 'brd', 'flutter', 'pvc'].includes(key)) card.style.borderLeftColor = 'var(--warning)';
        else card.style.borderLeftColor = 'var(--accent)';

        x = 0;
        ctx.fillStyle = "#000000";
        ctx.fillRect(0, 0, width, height);
    }

    init();
</script>

</body>
</html>